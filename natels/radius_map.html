<!DOCTYPE html>
<title>Query Circle</title>
<link rel="stylesheet" href="https://js.arcgis.com/3.23/dijit/themes/tundra/tundra.css">
<link rel="stylesheet" href="https://js.arcgis.com/3.23/esri/css/esri.css">
<head>
<style>
html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
}
#map {
    margin: 0;
    padding: 0;
}

#controls {
    position: absolute;
    font-family: arial;
    right: 20px;
    top: 10px;
    margin: 5px;
    padding: 5px;
    z-index: 40;
    background: #fff;
    color: #444;
    width: 440px;
    -moz-box-shadow: 0 0 5px #888;
    -webkit-box-shadow: 0 0 5px #888;
    box-shadow: 0 0 5px #888;
}
h3 {
    margin: 0 0 5px 0;
    border-bottom: 1px solid #444;
}
.label {
    display: inline-block;
    width: 140px;
}
ul{
    padding: 0.75em;
    list-style-type: none;
    overflow: hidden;
    overflow-y: scroll;
    height: 300px;
}
li{
    padding: .2em;

}
#dnr_logo {
        background-image: url(img/georgia-rare-natural-elements-half-size.png);
        border-style: solid;
        border-color: #999;
        border-width: 2px;
        border-radius: 10px;
        outline-width: 2px;
        position: absolute;
        width: 80px;
        height: 30px;
        left: 10px;
        bottom: 38px;
        margin-bottom: 5px;
        padding: 10px 38px;
        box-shadow: 0 0 10px #999;
        z-index: 40;
    }
    #wrd_logo {
        background-image: url(img/wrd_logo.png);
        border-style: solid;
        border-color: #999;
        border-width: 2px;
        border-radius: 10px;
        outline-width: 2px;
        position: absolute;
        width: 130px;
        height: 60px;
        left: 10px;
        bottom: 100px;
        margin-bottom: 5px;
        padding: 10px 38px;
        box-shadow: 0 0 10px #999;
        z-index: 40;
    }
.dijitNumberTextBox {
    width: 30px;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://js.arcgis.com/3.23/"></script>
<script>
require([
    "dojo/parser", "esri/graphic",
    "esri/Color", "dojo/_base/array", "dojo/dom",
    "esri/config", "esri/map", "esri/geometry/Circle",
    "esri/symbols/SimpleFillSymbol", "esri/symbols/SimpleLineSymbol",
    "esri/tasks/query", "esri/tasks/QueryTask", "dijit/form/NumberTextBox",
    "dijit/layout/BorderContainer", "dijit/layout/ContentPane",
    "dojo/domReady!"], function (
        parser, Graphic,
        Color, arrayUtils, dom,
        esriConfig, Map, Circle,
        SimpleFillSymbol, SimpleLineSymbol,
        Query, QueryTask, NumberTextBox) {
        // create layout dijits
        parser.parse();
        var radiusValue = 5;
        new NumberTextBox({
		  value: "5",
          name: "programmatic",
          onChange: function(value){
			radiusValue = value;
			}
    }, "programmatic").startup();


        map = new Map("map", {
            basemap: "osm",
            center: [-83.441162, 33.247875],
            zoom: 7
        });
        
        // query task and query for parcels
        var qtParcels = new QueryTask("https://services6.arcgis.com/9QlSLDqa0P1cHLhu/arcgis/rest/services/quarterquad/FeatureServer/0");
        var qParcels = new Query();
        
        qParcels.returnGeometry = true;
        qParcels.outFields = ["*"];
        var qGeom;
        
        map.on("click", executeQueries);
        
        function executeQueries(e) {
            var parcels, point;
            
            // this is used to return features within 100 meters of the click point
            point = e.mapPoint;
            qGeom = new Circle(point, {
                "radius": radiusValue,
                "spatialReference": point.spatialReference,
                radiusUnit: "esriMiles"
            });
            
            // use the circle for the query geometry
            qParcels.geometry = qGeom;
            qtParcels.execute(qParcels, handleQueryResults);
        }
        
        function handleQueryResults(results) {
            map.graphics.clear();
            // add the results to the map
            var comName = [];
		    var sName = [];
            arrayUtils.forEach(results.features, function (feat) {
                feat.setSymbol(new SimpleFillSymbol());
                map.graphics.add(feat);
            comName.push(feat.attributes["scomname"]);
			sName.push(feat.attributes["sname"]);
            });
            var comName = comName.filter(function(item, i, ar){ return ar.indexOf(item) === i; });
		    var sName = sName.filter(function(item, i, ar){ return ar.indexOf(item) === i; });
            var comList = "";
            var sList = "";
            for(i=0; i<comName.length; i++){comList += "<li>"+comName[i]+"</li>";}
            for(i=0; i<sName.length; i++){sList += "<li>"+sName[i]+"</li>";}

            dom.byId("results").innerHTML = "<b>A total of <i>" + comName.length + "</i> unique species have been identified within this range.</b></br>" + '<button id="commonButton">Common Name</button>'+'<button id="scientificButton">Scientific Name</button>' +"<hr>" + '<div id="commonName" style="display: none;"><ul>'+ comList  +'</ul></div><div id="scientificName" style="display: none;"><ul>'+ sList +'</ul></div>' + '<p><font size="4">For more detailed information ' + '<a href = "#" >click here</a></font></p>';
          
            var commonLink = document.getElementById('commonButton');
			var scientificLink = document.getElementById('scientificButton');
            commonLink.addEventListener('click', commonFunction);
			scientificLink.addEventListener('click', scientificFunction);
            // show the circle used
            var circleGra = new Graphic(qGeom, new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID,
                                  new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHDOT,
                                  new Color([255, 0, 0]), 2), new Color([255, 255, 0, 0.25])));
            map.graphics.add(circleGra);
        }



            function commonFunction() {
			var x = document.getElementById("commonName");
			if (x.style.display === "none") {
			x.style.display = "block";
			} else {
			x.style.display = "none";
				   }
							 }
			function scientificFunction() {
			var x = document.getElementById("scientificName");
			if (x.style.display === "none") {
			x.style.display = "block";
			} else {
			x.style.display = "none";
				   }
							 }


    });

</script>

</head>
<body class="tundra">
    
    <div data-dojo-type="dijit.layout.BorderContainer" data-dojo-props="design:'headline',gutters:false" style="width: 100%; height: 100%; margin: 0;">
        <div id="map" data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region:'center'">
            <div id="controls">
                 <p>Search for elements within<span id="programmatic"></span> miles</p>
                <div id="results">Click the map to query using your chosen radius.</div>
            </div>
            <a href="home.html"><div id="dnr_logo"></div></a>
            <a href="http://georgiawildlife.com/"><div id="wrd_logo"></div></a>
        </div>
    </div>
</body>
</html>